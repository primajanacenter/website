<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cek Royalti</title>
  <link rel="icon" href="https://res.cloudinary.com/djexglfns/image/upload/v1754976459/WhatsApp_Image_2025-08-12_at_1.15.37_PM-removebg-preview_ipix4s.png" type="image/x-icon">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    :root {
      --primary-blue: #0056b3;
      --accent-green: #28a745;
      --highlight-purple: #6f42c1;
      --light-bg: #f8f9fa;
      --dark-text: #343a40;
      --secondary-text: #6c757d;
    }

    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: var(--dark-text); background:#fff; }
    .navbar { background: rgba(255,255,255,0.95)!important; box-shadow:0 2px 5px rgba(0,0,0,0.08); }
    .navbar-brand img { max-height:60px; }
    .nav-link { color: var(--secondary-text)!important; }
    .nav-link:hover,.nav-link.active{ color:var(--primary-blue)!important; }
    .royalty-section { background: var(--light-bg); padding:120px 1rem 80px; }
    .summary-box { background:#fff; border-radius:12px; padding:20px; text-align:center; box-shadow:0 3px 12px rgba(0,0,0,0.08); margin-bottom:20px; }
    .summary-box h5 { font-weight:600; font-size:1rem; color:var(--secondary-text); }
    .summary-box p { font-size:1.5rem; font-weight:bold; color:var(--dark-text); }
    .card { border:none; border-radius:15px; box-shadow:0 4px 15px rgba(0,0,0,0.08); margin-bottom:30px; }
    .card-header { background:var(--primary-blue); color:#fff; font-weight:600; text-align:center; border-radius:15px 15px 0 0; }
    #bookSearchResults { position:absolute; top:100%; left:0; right:0; z-index:1000; background:#fff; border:1px solid #ddd; border-top:none; border-radius:0 0 8px 8px; max-height:200px; overflow-y:auto; display:none; }
    .search-result-item { padding:10px; cursor:pointer; }
    .search-result-item:hover{ background:#f8f9fa; }
    .footer{ background:var(--dark-text); color:white; padding:20px 0; margin-top:50px; }

    /* FIX: tinggi canvas untuk chart */
    #salesChart { width: 100%; height: 400px; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light fixed-top">
  <div class="container">
    <a class="navbar-brand" href="#"><img src="https://res.cloudinary.com/djexglfns/image/upload/v1754976459/WhatsApp_Image_2025-08-12_at_1.15.37_PM-removebg-preview_ipix4s.png" alt="Logo"></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="index.html">Beranda</a></li>
        <li class="nav-item"><a class="nav-link" href="about.html">Tentang</a></li>
        <li class="nav-item"><a class="nav-link" href="services.html">Layanan</a></li>
        <li class="nav-item"><a class="nav-link" href="bimbingan.html">Bimbingan</a></li>
        <li class="nav-item"><a class="nav-link" href="pendampingan.html">Pendampingan</a></li>
        <li class="nav-item"><a class="nav-link" href="tools.html">Tools</a></li>
        <li class="nav-item"><a class="nav-link active" href="publication.html">Publikasi</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Kontak</a></li>
      </ul>
    </div>
  </div>
</nav>

<section class="royalty-section">
  <div class="row mb-4">
    <div class="col-md-6 offset-md-3">
      <div id="bookSearchContainer" class="input-group">
        <label class="input-group-text" for="bookSearchInput">Cari Judul Buku:</label>
        <input type="text" class="form-control" id="bookSearchInput" placeholder="Ketik judul buku...">
        <div id="bookSearchResults"></div>
      </div>
    </div>
  </div>

  <div class="row text-center">
    <div class="col-md-6"><div class="summary-box bg-light"><h5>Royalti Penulis</h5><p id="royaltiPenulis">Rp 0</p></div></div>
    <div class="col-md-6"><div class="summary-box bg-light"><h5>Unit Terjual</h5><p id="bukuTerjual">0</p></div></div>
  </div>

  <hr>

  <div class="row">
    <div class="col-md-12">
      <div class="card mb-4"><div class="card-header text-center"><h4>Grafik Harian (30 Hari Terakhir)</h4></div><div class="card-body"><canvas id="salesChart"></canvas></div></div>
    </div>
  </div>

  <hr>

  <div class="row">
    <div class="col-md-12">
      <div class="card"><div class="card-header text-center"><h4>Detail Transaksi</h4></div><div class="card-body"><div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>Tanggal</th><th>Judul Buku</th><th>Royalti Penulis</th></tr></thead><tbody id="transactionsTableBody"></tbody></table></div></div></div>
    </div>
  </div>
</section>

<footer class="footer"><div class="container text-center"><p class="mb-0">Â© 2025 PT Primajana Bagia Mesari</p></div></footer>

<a href="https://wa.me/+6285935201571" class="whatsapp-float" target="_blank"><i class="bi bi-whatsapp"></i></a>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const rawData = [
    { "Transaction Date": "5/9/2022", "Title": "Kumpulan Karya Esai Juara", "List Price [tax inclusive]": 72150 },
    { "Transaction Date": "2/9/2022", "Title": "Essay is Easy: 11 Tips Pasti Juara...", "List Price [tax inclusive]": 105450 },
    { "Transaction Date": "9/13/22", "Title": "Panduan Program HIV...", "List Price [tax inclusive]": 0 },
    { "Transaction Date": "9/15/22", "Title": "Essay is Easy: 11 Tips Pasti Juara...", "List Price [tax inclusive]": 105450 },
    { "Transaction Date": "9/16/22", "Title": "Panduan Program HIV...", "List Price [tax inclusive]": 0 }
  ];

  const ROYALTY_AUTHOR_PERCENTAGE = 0.40;
  const GOOGLE_SHARE_PERCENTAGE = 0.50;

  function parseDate(dateStr) {
    const parts = dateStr.split(/[\/\-]/);
    let month = parseInt(parts[0], 10) - 1;
    let day = parseInt(parts[1], 10);
    let year = parts[2].length === 2 ? 2000 + parseInt(parts[2], 10) : parseInt(parts[2], 10);
    return new Date(year, month, day);
  }

  function processData(data) {
    return data.map(item => {
      const pendapatanKotor = item["List Price [tax inclusive]"];
      const royaltiBersih = pendapatanKotor * (1 - GOOGLE_SHARE_PERCENTAGE);
      const royaltiPenulis = pendapatanKotor > 0 ? royaltiBersih * ROYALTY_AUTHOR_PERCENTAGE : 0;
      return { date: parseDate(item["Transaction Date"]), title: item["Title"], royaltiPenulis };
    });
  }

  const processedData = processData(rawData);
  const allBookTitles = [...new Set(rawData.map(item => item.Title))];

  function formatRupiah(number) { return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0}).format(number); }

  function displaySearchResults(query) {
    const resDiv=document.getElementById('bookSearchResults');resDiv.innerHTML='';
    if(!query){resDiv.style.display='none';return;}
    const results=allBookTitles.filter(title=>title.toLowerCase().includes(query.toLowerCase()));
    results.forEach(title=>{const div=document.createElement('div');div.className='search-result-item';div.textContent=title;div.onclick=()=>{document.getElementById('bookSearchInput').value=title;updateDisplay(title);resDiv.style.display='none';};resDiv.appendChild(div);});
    resDiv.style.display=results.length? 'block':'none';
  }

  function updateDisplay(selectedTitle) {
    const filtered=processedData.filter(item=>item.title===selectedTitle);
    const totalRoyalti=filtered.reduce((acc,item)=>acc+item.royaltiPenulis,0);
    const totalTerjual=filtered.length;
    document.getElementById('royaltiPenulis').textContent=formatRupiah(totalRoyalti);
    document.getElementById('bukuTerjual').textContent=totalTerjual;
    updateTransactionsTable(filtered);
    updateChart(filtered);
  }

  function updateTransactionsTable(data){
    const tbody=document.getElementById('transactionsTableBody');
    tbody.innerHTML='';
    data.forEach(item=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${item.date.toLocaleDateString('id-ID')}</td><td>${item.title}</td><td>${formatRupiah(item.royaltiPenulis)}</td>`;
      tbody.appendChild(tr);
    });
  }

  let salesChart = null;
function updateChart(data) {
    const ctx = document.getElementById('salesChart').getContext('2d');

    // Gabungkan transaksi per hari
    const dailyTotals = {};
    data.forEach(item => {
        const key = item.date.toLocaleDateString('id-ID'); // label tanggal
        if (!dailyTotals[key]) dailyTotals[key] = 0;
        dailyTotals[key] += item.royaltiPenulis;
    });

    const labels = Object.keys(dailyTotals).sort((a,b) => new Date(a) - new Date(b));
    const values = labels.map(label => dailyTotals[label]);

    if (salesChart) salesChart.destroy();

    salesChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Royalti Penulis (Rp)',
                data: values,
                backgroundColor: 'rgba(0,123,255,0.6)',
                borderColor: 'rgba(0,123,255,1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Royalti (Rp)' },
                    ticks: {
                        callback: function(value) { return formatRupiah(value); }
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) { return formatRupiah(context.parsed.y); }
                    }
                }
            }
        }
    });
}


  document.getElementById('bookSearchInput').addEventListener('input',e=>displaySearchResults(e.target.value));
});
</script>
</body>
</html>
