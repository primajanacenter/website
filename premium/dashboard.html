<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Premium</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box;}
body{margin:0;background:#f5f7fb;font-family:system-ui;}
.header{
 background:#fff;padding:15px 30px;
 display:flex;justify-content:space-between;align-items:center;
 box-shadow:0 2px 6px rgba(0,0,0,.05);
}
.main{padding:25px;max-width:1100px;margin:auto;}
.card{
 background:#fff;border-radius:18px;padding:22px;
 box-shadow:0 8px 25px rgba(0,0,0,.05);
 margin-bottom:22px;
}
.btn{background:#0d6efd;color:#fff;border:none;border-radius:8px;padding:6px 16px;cursor:pointer;}
.status-active{color:#198754;font-weight:700;}
.status-inactive{color:#dc3545;font-weight:700;}
iframe{
 width:100%;
 min-height:520px;
 border:none;
 border-radius:14px;
}
</style>
</head>
<body>

<div class="header">
 <b>Dashboard Premium</b>
 <button class="btn" onclick="logout()">Logout</button>
</div>

<div class="main">

<!-- STATUS LANGGANAN -->
<div class="card">
 <b>Status Berlangganan:</b>
 <span id="substatus" class="status-inactive">Memuat...</span><br><br>
 <div id="expiredInfo"></div>
 <button id="payBtn" class="btn" style="display:none;margin-top:12px" onclick="subscribe()">Berlangganan / Perpanjang</button>
</div>

<!-- LIST APLIKASI PREMIUM -->
<div class="card">
 <b>Daftar Aplikasi Premium</b>
 <iframe id="appFrame" src=""></iframe>
</div>

</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const SUPABASE_URL = "https://jzrqalbhvjkgradpnbcp.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6cnFhbGJodmprZ3JhZHBuYmNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2NzQ2NTksImV4cCI6MjA4MzI1MDY1OX0.yOGN7e7Bu6Yvm1gDaF1URHF7Mjcj7aVHfJ5URHRWyaE";
const MAYAR_LINK = "https://primajana.myr.id/membership/primajana-tools-membership-bulanan";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

window.logout = async()=>{
  await supabase.auth.signOut();
  location.href="login.html";
}
window.subscribe = ()=> location.href = MAYAR_LINK;

const { data:{ session } } = await supabase.auth.getSession();
if(!session) location.href="login.html";

const { data } = await supabase.from("subscriptions").select("*").single();

if(data && data.active){
  substatus.innerText = "AKTIF";
  substatus.className = "status-active";

  const exp = new Date(data.expired_at);
  expiredInfo.innerHTML = `
    Masa aktif sampai:
    <b>${exp.toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric"})}</b>
  `;

  document.getElementById("appFrame").src = "https://primajana.com/premium/beranda.html";

}else{
  substatus.innerText = "TIDAK AKTIF";
  substatus.className = "status-inactive";
  expiredInfo.innerText = "Silakan berlangganan untuk membuka semua aplikasi premium.";
  payBtn.style.display="inline-block";
}
</script>

</body>
</html>
