<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box;}
body{margin:0;background:#f5f7fb;font-family:system-ui;}
.header{
 background:#fff;padding:15px 30px;
 display:flex;justify-content:space-between;align-items:center;
 box-shadow:0 2px 6px rgba(0,0,0,.05);
}
.main{padding:25px;max-width:1100px;margin:auto;}
.card{
 background:#fff;border-radius:18px;padding:22px;
 box-shadow:0 8px 25px rgba(0,0,0,.05);
}
.grid{
 margin-top:20px;
 display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:18px;
}
.tool{
 padding:22px;border-radius:14px;border:1px solid #eee;
 text-align:center;font-weight:600;cursor:pointer;
 transition:.2s;
}
.tool:hover{background:#f0f5ff;}
.btn{background:#0d6efd;color:#fff;border:none;border-radius:8px;padding:6px 16px;cursor:pointer;}
.status{color:#198754;font-weight:700;}
.lock{color:#dc3545;font-weight:700;}
</style>
</head>
<body>

<div class="header">
 <b>Dashboard</b>
 <button class="btn" onclick="logout()">Logout</button>
</div>

<div class="main">

<div class="card">
 Status Langganan:
 <span id="substatus" class="lock">Memuat...</span>
 <div id="countdown"></div>
 <br>
 <button id="payBtn" class="btn" style="display:none" onclick="subscribe()">Berlangganan / Perpanjang</button>
</div>

<div class="grid">
 <div class="tool" onclick="openApp('app-regresi.html')">ğŸ“ˆ Regresi</div>
 <div class="tool" onclick="openApp('app-chisquare.html')">ğŸ“Š Chi-Square</div>
 <div class="tool" onclick="openApp('app-dotmap.html')">ğŸ—º Dotmap</div>
 <div class="tool">ğŸ’³ Riwayat Pembayaran</div>
 <div class="tool">ğŸ Promo</div>
</div>

</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const SUPABASE_URL = "https://jzrqalbhvjkgradpnbcp.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6cnFhbGJodmprZ3JhZHBuYmNwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2NzQ2NTksImV4cCI6MjA4MzI1MDY1OX0.yOGN7e7Bu6Yvm1gDaF1URHF7Mjcj7aVHfJ5URHRWyaE";

const MAYAR_LINK = "https://primajana.myr.id/membership/primajana-tools-membership-bulanan";

const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

window.openApp = u => location.href = u;

window.logout = async function(){
  await supabase.auth.signOut();
  location.href = "login.html";
}

window.subscribe = function(){
  location.href = MAYAR_LINK;
}

const { data:{ session } } = await supabase.auth.getSession();
if(!session) location.href="login.html";

const { data } = await supabase.from("subscriptions").select("*").single();

if(data && data.active){
  substatus.innerText = "AKTIF";
  substatus.className = "status";

  const exp = new Date(data.expired_at);
  setInterval(()=>{
    const d = Math.max(0, Math.floor((exp - new Date()) / 86400000));
    countdown.innerText = "Berakhir dalam " + d + " hari";
  },1000);
}else{
  substatus.innerText = "TIDAK AKTIF";
  document.getElementById("payBtn").style.display="inline-block";
}
</script>

</body>
</html>
