<script>
const PRODUCT_FILES = [
  "/digital/produk000001.html",
  "/digital/produk000002.html"
];

const list = document.getElementById("productList");

Promise.all(
  PRODUCT_FILES.map(file =>
    fetch(file).then(r=>r.text()).then(html => {

      const m = html.match(/PRODUCT_LINK\s*=\s*["'](.*?)["']/);
      if(!m) return null;

      const link = m[1];

      /* ====== EBOOK GOOGLE PLAY ===== */
      if(link.includes("play.google.com/store/books")){
        const id = new URL(link).searchParams.get("id");
        return fetch(`https://www.googleapis.com/books/v1/volumes/${id}`)
          .then(r=>r.json())
          .then(d=>({
            type:"E-Book",
            title:d.volumeInfo.title,
            author:(d.volumeInfo.authors||["Primajana"]).join(", "),
            image:`https://books.google.co.id/books/publisher/content/images/frontcover/${id}?fife=w300-h400`,
            file
          }));
      }

      /* ====== COURSE / PRODUK DIGITAL ===== */
      return {
        type:"Produk Digital",
        title:link.split("/").pop().replace(/[-_]/g," ").toUpperCase(),
        author:"Primajana Digital",
        image:"https://primajana.com/assets/digital-default.png",
        file
      };

    })
  )
).then(data=>{
  render(data.filter(x=>x));
});

function render(data){
  list.innerHTML="";
  data.forEach(p=>{
    list.innerHTML+=`
    <div class="card">
      <div class="badge-type">${p.type}</div>
      <img src="${p.image}">
      <h4>${p.title}</h4>
      <div class="meta">${p.author}</div>
      <a class="btn" href="${p.file}">Lihat Produk</a>
    </div>`;
  });
}
</script>
